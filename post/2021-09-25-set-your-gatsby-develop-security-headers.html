<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="Online space, blog and portfolio"/><title>Karin Hendrikse | TIL: How to set security headers for Gatsby Develop</title><script defer="" data-domain="khendrikse.github.io" src="https://plausible.io/js/plausible.js"></script><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/d3efe417e8ab59d4e978.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d3efe417e8ab59d4e978.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cab139b8b70b2a825fa5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cab139b8b70b2a825fa5.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-90a60b87fd0d5fc150f2.js" defer=""></script><script src="/_next/static/chunks/framework-2f612445bd50b211f15a.js" defer=""></script><script src="/_next/static/chunks/main-731fe51bb2fe3194f241.js" defer=""></script><script src="/_next/static/chunks/pages/_app-201d0b8b91e54bac8c11.js" defer=""></script><script src="/_next/static/chunks/731-6f0d1f99ad2b4ef66145.js" defer=""></script><script src="/_next/static/chunks/819-10969b2313718390beff.js" defer=""></script><script src="/_next/static/chunks/337-6d43aa09dc069e3db0c8.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bpostname%5D-a4d37dff43f60c0b0664.js" defer=""></script><script src="/_next/static/2zoDLyhEljum4405H5Fam/_buildManifest.js" defer=""></script><script src="/_next/static/2zoDLyhEljum4405H5Fam/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="wrapper"><section class="layout"><header><nav class="navbar_navbar__1QDXy"><div class="navbar_navbar__inner__1dVAh"><h1 class="navbar_navbar__title__1XHtO"><a href="/">Karin Hendrikse</a></h1><ul class="navbar_navbar__menu__2og52"><li><a class="navbar_navbar__menu__item__3A2Fp" href="/about">About</a></li><li><a class="navbar_navbar__menu__item__3A2Fp" href="/blog">Blog</a></li><li><a class="navbar_navbar__menu__item__3A2Fp" href="/projects">Projects</a></li><li><a class="navbar_navbar__menu__item__3A2Fp" href="/">Home</a></li></ul></div></nav></header><div class="content"><article><img class="post_post__header__image__PDYc8" src="data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAHAAoDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAUG/8QAHBAAAgICAwAAAAAAAAAAAAAAAAECAxESUYGS/8QAFAEBAAAAAAAAAAAAAAAAAAAAA//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhEDEQA/ANjZNqDeueyzvZzHyAOJ/9k=" alt="a white cat napping" style="transition:0.2s filter linear;filter:blur(20px)"/><div class="container"><div class="post_post__header__title__1gD1Q"><h1>TIL: How to set security headers for Gatsby Develop</h1><div class="post_post__date_label__3dR5g">2021-09-25</div></div></div><div class="post_post__body__2TJcL"><div class="container"><div class="post_post__intro__Nk6io"></div><p>Photo by <a href="https://unsplash.com/@hngstrm">Henry &amp; Co</a> on <a href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p><p>There might come a time that you want to run your <a href="https://www.gatsbyjs.com/">Gatsby</a> app with security headers in development. To do this, you can utilize advanced proxying. Gatsby has a way to expose the <a href="https://expressjs.com/">Express.js</a> development server it uses to run the app whenever you use <code>gatsby develop</code>. This way you can add Express middleware.</p><h2>TL;DR</h2><p>If you just want to get your solution, feel free to use this setup inside your <code>gatsby-config.js</code> to set any security header you want. This example shows how you could set the <code>X-Frame-Options</code> HTTP response header to DENY.</p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">// gatsby-config.js</span><span>
</span>
<span></span><span class="token" style="color:#07a">const</span><span> </span><span class="token" style="color:#999">{</span><span> createProxyMiddleware </span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#DD4A68">require</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;http-proxy-middleware&quot;</span><span class="token" style="color:#999">)</span><span>
</span>
<span>module</span><span class="token" style="color:#999">.</span><span class="token property-access">exports</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>  </span><span class="token function-variable" style="color:#DD4A68">developMiddleware</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token parameter">app</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>     app</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">use</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token parameter">req</span><span class="token parameter" style="color:#999">,</span><span class="token parameter"> res</span><span class="token parameter" style="color:#999">,</span><span class="token parameter"> next</span><span class="token" style="color:#999">)</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>      res</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">set</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;X-Frame-Options&#x27;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">&#x27;DENY&#x27;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>      </span><span class="token" style="color:#DD4A68">next</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">,</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></pre><h2>Let&#x27;s break it down</h2><p>First we make sure we actually have a <code>gatsby-config.js</code> file. This file should be in the root of your Gatsby project and it can contain a bunch of different information. If you want to know more about this file, check out <a href="https://www.gatsbyjs.com/docs/reference/config-files/gatsby-config/">Gatsby&#x27;s own docs</a>.</p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">// gatsby-config.js</span><span>
</span>
<span>module</span><span class="token" style="color:#999">.</span><span class="token property-access">exports</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>  </span><span class="token" style="color:slategray">// an empty config file!</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></pre><h3>Using developMiddleware</h3><p>To expose Express.js we use the configuration key called <code>developMiddleware</code>. We pass it a function that takes a parameter called <code>app</code>. We can use that to <a href="https://expressjs.com/en/guide/using-middleware.html">add middleware</a> to Express.js.</p><p>We use <code>app.use()</code> and pass it a function that takes <code>req, res, next</code> parameters. Inside the function we set our security header on the <code>res</code> (response) object. After this, we call the next function that we got as a parameter.</p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">// gatsby-config.js</span><span>
</span>
<span>module</span><span class="token" style="color:#999">.</span><span class="token property-access">exports</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>  </span><span class="token function-variable" style="color:#DD4A68">developMiddleware</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token parameter">app</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>     app</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">use</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token parameter">req</span><span class="token parameter" style="color:#999">,</span><span class="token parameter"> res</span><span class="token parameter" style="color:#999">,</span><span class="token parameter"> next</span><span class="token" style="color:#999">)</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>      res</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">set</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;X-Frame-Options&#x27;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">&#x27;DENY&#x27;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>      </span><span class="token" style="color:#DD4A68">next</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">,</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></pre><p>Done! You should now be able to run <code>gatsby develop</code> and see the proper security headers on the documents that it serves you. Make sure to restart your server if you already had it running though, otherwise the changes won&#x27;t come through.</p></div></div></article></div></section></div><div class="footer_footer__qYcpy"><div class="footer_footer__links__5CZ7M"><a class="footer_footer__link__mPbqN" href="https://dev.to/khenhey"><img width="24px" height="24px" src="/assets/images/devto.svg?" alt="DEV.to icon"/>dev.to</a><a class="footer_footer__link__mPbqN" href="https://github.com/khendrikse"><img width="24px" height="24px" src="/assets/images/github.svg?" alt="GitHub icon"/>GitHub</a><a class="footer_footer__link__mPbqN" href="https://www.linkedin.com/in/karinhendrikse/"><img width="24px" height="24px" src="/assets/images/linkedin.svg" alt="LinkedIn icon"/>LinkedIn</a></div>© 2021 Karin Hendrikse</div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"siteTitle":"Karin Hendrikse","frontmatter":{"layout":"post","title":"TIL: How to set security headers for Gatsby Develop","published":false,"description":"If, for any reason, you need to run gatsby develop and set security headers. Using advanced proxying is the way to go.","intro":null,"cover_image":"2021-09-25.jpg","cover_image_alt":"a white cat napping"},"markdownBody":"\nPhoto by [Henry \u0026 Co](https://unsplash.com/@hngstrm) on [Unsplash](https://unsplash.com/?utm_source=unsplash\u0026utm_medium=referral\u0026utm_content=creditCopyText)\n\nThere might come a time that you want to run your [Gatsby](https://www.gatsbyjs.com/) app with security headers in development. To do this, you can utilize advanced proxying. Gatsby has a way to expose the [Express.js](https://expressjs.com/) development server it uses to run the app whenever you use `gatsby develop`. This way you can add Express middleware.\n\n## TL;DR\n\nIf you just want to get your solution, feel free to use this setup inside your `gatsby-config.js` to set any security header you want. This example shows how you could set the `X-Frame-Options` HTTP response header to DENY.\n\n```js\n// gatsby-config.js\n\nconst { createProxyMiddleware } = require(\"http-proxy-middleware\")\n\nmodule.exports = {\n  developMiddleware: app =\u003e {\n     app.use((req, res, next) =\u003e {\n      res.set('X-Frame-Options', 'DENY');\n      next();\n    });\n  },\n}\n```\n\n## Let's break it down\n\nFirst we make sure we actually have a `gatsby-config.js` file. This file should be in the root of your Gatsby project and it can contain a bunch of different information. If you want to know more about this file, check out [Gatsby's own docs](https://www.gatsbyjs.com/docs/reference/config-files/gatsby-config/).\n\n```js\n// gatsby-config.js\n\nmodule.exports = {\n  // an empty config file!\n}\n```\n\n### Using developMiddleware\n\nTo expose Express.js we use the configuration key called `developMiddleware`. We pass it a function that takes a parameter called `app`. We can use that to [add middleware](https://expressjs.com/en/guide/using-middleware.html) to Express.js.\n\nWe use `app.use()` and pass it a function that takes `req, res, next` parameters. Inside the function we set our security header on the `res` (response) object. After this, we call the next function that we got as a parameter.\n\n```js\n// gatsby-config.js\n\nmodule.exports = {\n  developMiddleware: app =\u003e {\n     app.use((req, res, next) =\u003e {\n      res.set('X-Frame-Options', 'DENY');\n      next();\n    });\n  },\n}\n```\n\nDone! You should now be able to run `gatsby develop` and see the proper security headers on the documents that it serves you. Make sure to restart your server if you already had it running though, otherwise the changes won't come through.\n","date":["2021-09-25"]},"__N_SSG":true},"page":"/post/[postname]","query":{"postname":"2021-09-25-set-your-gatsby-develop-security-headers"},"buildId":"2zoDLyhEljum4405H5Fam","runtimeConfig":{},"isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>