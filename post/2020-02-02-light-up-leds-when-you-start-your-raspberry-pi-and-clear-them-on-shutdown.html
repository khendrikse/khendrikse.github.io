<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="Online space, blog and portfolio"/><title>Karin Hendrikse | Light up LEDs when you start your Raspberry Pi and clear them on shutdown</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/732ee4fb28785efcf7c7.css" as="style"/><link rel="stylesheet" href="/_next/static/css/732ee4fb28785efcf7c7.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cab139b8b70b2a825fa5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cab139b8b70b2a825fa5.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-61095c13c5984b221292.js" defer=""></script><script src="/_next/static/chunks/framework-2191d16384373197bc0a.js" defer=""></script><script src="/_next/static/chunks/main-a3a79aff3ff232b41814.js" defer=""></script><script src="/_next/static/chunks/pages/_app-00245ee3542c987e90b1.js" defer=""></script><script src="/_next/static/chunks/996-9333713592b33abcda8c.js" defer=""></script><script src="/_next/static/chunks/724-879f15712371cf00c10e.js" defer=""></script><script src="/_next/static/chunks/961-0aeaac38aba57f22249c.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bpostname%5D-d19e2e35d1ec4317aac6.js" defer=""></script><script src="/_next/static/Lx-5Y212UvIhz6ZuVNGXm/_buildManifest.js" defer=""></script><script src="/_next/static/Lx-5Y212UvIhz6ZuVNGXm/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="wrapper"><section class="layout"><header><nav class="navbar_navbar__1QDXy"><div class="navbar_navbar__inner__1dVAh"><h1 class="navbar_navbar__title__1XHtO"><a href="/">Karin Hendrikse</a></h1><ul class="navbar_navbar__menu__2og52"><li><a class="navbar_navbar__menu__item__3A2Fp" href="/about">About</a></li><li><a class="navbar_navbar__menu__item__3A2Fp" href="/blog">Blog</a></li><li><a class="navbar_navbar__menu__item__3A2Fp" href="/projects">Projects</a></li><li><a class="navbar_navbar__menu__item__3A2Fp" href="/">Home</a></li></ul></div></nav></header><div class="content"><article><img class="post_post__header__image__PDYc8" src="https://dev-to-uploads.s3.amazonaws.com/i/5o1drx3yby1z853rjm8d.JPG?lqip" alt="a raspberry pi with blue and purple LEDs lighting up" style="transition:0.2s filter linear;filter:blur(20px)"/><div class="container"><div class="post_post__header__title__1gD1Q"><h1>Light up LEDs when you start your Raspberry Pi and clear them on shutdown</h1><div class="post_post__date_label__3dR5g">2020-02-02</div></div></div><div class="post_post__body__2TJcL"><div class="container"><div class="post_post__intro__Nk6io">In the last post we set up a small script to light up the Blinkt with beautiful purple-blue lights. In this post we&#x27;re going to automatically run a script when we turn the Pi on and stop and clear the LEDs when we turn it off.</div><p><em>You can actually use the techniques in this tutorial for any other script or board.</em></p><h2>Start the script when the Pi turns on</h2><p>There are many different ways to start running a script when the Pi is booting up. We are going to use <code>crontab</code>.</p><p>With <code>crontab</code> we can automate running a script at a certain moment. There are different options, such as running a script <code>yearly</code>, <code>daily</code> or on <code>reboot</code>. We will be using that last option ðŸ˜‰.</p><p>Make sure to be logged into your Pi and in the terminal run:</p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token" style="color:#DD4A68">crontab</span><span> -e</span></code></pre><p>This will open <code>crontab</code> in your editor. At the bottom of the file add:</p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>@reboot python /home/pi/Pimoroni/blue_purple.py </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&amp;</span></code></pre><p>We use <code>@reboot</code> to tell the <code>crontab</code> that we want to run the script whenever the device reboots. <code>python</code> is used to run the Python script and <code>&amp;</code> makes the script run as a background script so you can use your terminal while the script is running. Make sure to add the absolute path to the script you want to run when starting up.</p><p>Save and close the file, that&#x27;s it for the first part. You can now restart your Pi with <code>sudo reboot</code> and it should automatically start running your script in the background once it starts up again.</p><h3>How to kill your background process</h3><p>If for any reason you want to stop the script, all you have to do is find its Process Identifier (PID) by running <code>ps aux | grep python</code> and finding the script in the list of processes. The output would look something like this:</p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>pi         </span><span class="token" style="color:#905">394</span><span> </span><span class="token" style="color:#905">35.3</span><span>  </span><span class="token" style="color:#905">1.7</span><span>  </span><span class="token" style="color:#905">32420</span><span> </span><span class="token" style="color:#905">16352</span><span> ?        S    </span><span class="token" style="color:#905">12</span><span>:09  </span><span class="token" style="color:#905">34</span><span>:34 python /home/pi/Pimoroni/blue_purple.py
</span><span>pi         </span><span class="token" style="color:#905">771</span><span>  </span><span class="token" style="color:#905">0.0</span><span>  </span><span class="token" style="color:#905">0.0</span><span>   </span><span class="token" style="color:#905">7348</span><span>   </span><span class="token" style="color:#905">492</span><span> pts/0    S+   </span><span class="token" style="color:#905">13</span><span>:46   </span><span class="token" style="color:#905">0</span><span>:00 </span><span class="token" style="color:#DD4A68">grep</span><span> --color</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span>auto python</span></code></pre><p>The PID is the number right next to the <code>pi</code>. In the example, it is <code>394</code> Once you have the PID run <code>kill 349</code> replacing <code>349</code> with the number of your PID.</p><h3>Turning off the LEDs and clearing them</h3><p>Let&#x27;s run a little test. Try shutting down your Pi while the LEDs are running. We can do that by typing:</p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token" style="color:#DD4A68">sudo</span><span> </span><span class="token" style="color:#DD4A68">shutdown</span><span> now</span></code></pre><p>The Pi will shut itself down and the background script will also stop running. But you might notice that the LEDs did not clear. The Blinkt library has a function for clearing the LEDs when the script stops: <code>blinkt.set_clear_on_exit()</code>. But that only works when the script is explicitly stopped by us. On shutdown, this will have no effect. And as the Blinkt pixels seem to have memory, they will not clear unless we tell them to, or turn off the power.</p><p>So, let&#x27;s fix this.</p><p>Inside our Python script we are going to add a new library called <code>signal</code> underneath our other libraries:</p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-py" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">#!/usr/bin/env python</span><span>
</span>
<span></span><span class="token" style="color:#07a">import</span><span> blinkt
</span><span></span><span class="token" style="color:#07a">import</span><span> time
</span><span></span><span class="token" style="color:#07a">import</span><span> numpy
</span><span></span><span class="token" style="color:#07a">import</span><span> signal </span><span class="token" style="color:slategray"># new one!</span></code></pre><p>This will import the <code>signal</code> library. This library listens for signals from the system and makes it possible to run a function when we receive a specific signal.</p><p>When our Pi shuts down, it will send a signal called <code>SIGTERM</code>. This signal is sent whenever the system is doing a soft shutdown.</p><p>If our script receives this signal, we want to clear the LEDs and exit from the Python script. So in our Python file, add:</p><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-py" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">def</span><span> </span><span class="token" style="color:#DD4A68">clear_leds</span><span class="token" style="color:#999">(</span><span>signum</span><span class="token" style="color:#999">,</span><span> frame</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">:</span><span>
</span><span>        blinkt</span><span class="token" style="color:#999">.</span><span>clear</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span>
</span><span>        blinkt</span><span class="token" style="color:#999">.</span><span>show</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span>
</span><span>        exit</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">0</span><span class="token" style="color:#999">)</span><span>
</span>
<span>signal</span><span class="token" style="color:#999">.</span><span>signal</span><span class="token" style="color:#999">(</span><span>signal</span><span class="token" style="color:#999">.</span><span>SIGTERM</span><span class="token" style="color:#999">,</span><span> clear_leds</span><span class="token" style="color:#999">)</span></code></pre><p>The <code>clear_led</code> function has two arguments it automatically receives from the <code>signal.signal()</code> function. We don&#x27;t really need to use that so we just keep them there. The <code>blinkt.clear()</code> clears the LEDs and the <code>blinkt.show()</code> sets the new changes to the Blinkt so they can be seen. We then exit the Python script with <code>exit(0)</code>.</p><p>By writing <code>signal.signal(signal.SIGTERM, clear_leds)</code> the script will listen for the <code>SIGTERM</code> signal. Once it receives it, it will run the <code>clear_leds</code> function.</p><p>And that&#x27;s it! Reboot your system and once your LEDs are running again, try shutting the Pi off by using <code>sudo shutdown now</code>. After a second or so the LEDs should clear.</p><p>I had to find different sources to create this flow, so hopefully, this helps out anyone who wants to set it up the same way. Have fun and if you have it running, please share pictures of your awesome Pi!</p><p><strong>Check the <a href="https://github.com/khendrikse/blinkt-purple-blue/blob/master/blue_purple_with_cleanup.py">finished script</a></strong></p><p><em>Sources:</em>
<a href="https://www.dexterindustries.com/howto/run-a-program-on-your-raspberry-pi-at-startup/">Five ways to run a program on your Raspberry Pi at startup</a>
<a href="http://man7.org/linux/man-pages/man5/crontab.5.html">crontab</a>
<a href="https://docs.python.org/3/library/signal.html">Signal</a>
<a href="https://stackabuse.com/handling-unix-signals-in-python/">Handling Unix Signals in Python</a>
<a href="https://docs.python.org/2/library/sys.html">Sys exit</a></p></div></div></article></div></section></div><div class="footer_footer__qYcpy"><div class="footer_footer__links__5CZ7M"><a class="footer_footer__link__mPbqN" href="https://dev.to/khenhey"><img width="24px" height="24px" src="/assets/images/devto.svg?" alt="DEV.to icon"/>dev.to</a><a class="footer_footer__link__mPbqN" href="https://github.com/khendrikse"><img width="24px" height="24px" src="/assets/images/github.svg?" alt="GitHub icon"/>GitHub</a></div>Â© 2021 Karin Hendrikse</div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"siteTitle":"Karin Hendrikse","frontmatter":{"layout":"post","title":"Light up LEDs when you start your Raspberry Pi and clear them on shutdown","published":true,"description":"Set up your Pimoroni Blinkt so it automatically turns on and off when you start-up or shut down your Raspberry Pi.","cover_image":"https://dev-to-uploads.s3.amazonaws.com/i/5o1drx3yby1z853rjm8d.JPG","cover_image_alt":"a raspberry pi with blue and purple LEDs lighting up","tags":null,"intro":"In the last post we set up a small script to light up the Blinkt with beautiful purple-blue lights. In this post we're going to automatically run a script when we turn the Pi on and stop and clear the LEDs when we turn it off."},"markdownBody":"\n_You can actually use the techniques in this tutorial for any other script or board._\n\n## Start the script when the Pi turns on\n\nThere are many different ways to start running a script when the Pi is booting up. We are going to use `crontab`.\n\nWith `crontab` we can automate running a script at a certain moment. There are different options, such as running a script `yearly`, `daily` or on `reboot`. We will be using that last option ðŸ˜‰.\n\nMake sure to be logged into your Pi and in the terminal run:\n\n```bash\n$ crontab -e\n```\n\nThis will open `crontab` in your editor. At the bottom of the file add:\n\n```bash\n@reboot python /home/pi/Pimoroni/blue_purple.py \u0026\n```\n\nWe use `@reboot` to tell the `crontab` that we want to run the script whenever the device reboots. `python` is used to run the Python script and `\u0026` makes the script run as a background script so you can use your terminal while the script is running. Make sure to add the absolute path to the script you want to run when starting up.\n\nSave and close the file, that's it for the first part. You can now restart your Pi with `sudo reboot` and it should automatically start running your script in the background once it starts up again.\n\n### How to kill your background process\n\nIf for any reason you want to stop the script, all you have to do is find its Process Identifier (PID) by running `ps aux | grep python` and finding the script in the list of processes. The output would look something like this:\n\n```bash\npi         394 35.3  1.7  32420 16352 ?        S    12:09  34:34 python /home/pi/Pimoroni/blue_purple.py\npi         771  0.0  0.0   7348   492 pts/0    S+   13:46   0:00 grep --color=auto python\n\n```\n\nThe PID is the number right next to the `pi`. In the example, it is `394` Once you have the PID run `kill 349` replacing `349` with the number of your PID.\n\n### Turning off the LEDs and clearing them\n\nLet's run a little test. Try shutting down your Pi while the LEDs are running. We can do that by typing:\n\n```bash\n$ sudo shutdown now\n```\n\nThe Pi will shut itself down and the background script will also stop running. But you might notice that the LEDs did not clear. The Blinkt library has a function for clearing the LEDs when the script stops: `blinkt.set_clear_on_exit()`. But that only works when the script is explicitly stopped by us. On shutdown, this will have no effect. And as the Blinkt pixels seem to have memory, they will not clear unless we tell them to, or turn off the power.\n\nSo, let's fix this.\n\nInside our Python script we are going to add a new library called `signal` underneath our other libraries:\n\n```py\n#!/usr/bin/env python\n\nimport blinkt\nimport time\nimport numpy\nimport signal # new one!\n\n```\n\nThis will import the `signal` library. This library listens for signals from the system and makes it possible to run a function when we receive a specific signal.\n\nWhen our Pi shuts down, it will send a signal called `SIGTERM`. This signal is sent whenever the system is doing a soft shutdown.\n\nIf our script receives this signal, we want to clear the LEDs and exit from the Python script. So in our Python file, add:\n\n```py\ndef clear_leds(signum, frame):\n        blinkt.clear()\n        blinkt.show()\n        exit(0)\n\nsignal.signal(signal.SIGTERM, clear_leds)\n```\n\nThe `clear_led` function has two arguments it automatically receives from the `signal.signal()` function. We don't really need to use that so we just keep them there. The `blinkt.clear()` clears the LEDs and the `blinkt.show()` sets the new changes to the Blinkt so they can be seen. We then exit the Python script with `exit(0)`.\n\nBy writing `signal.signal(signal.SIGTERM, clear_leds)` the script will listen for the `SIGTERM` signal. Once it receives it, it will run the `clear_leds` function.\n\nAnd that's it! Reboot your system and once your LEDs are running again, try shutting the Pi off by using `sudo shutdown now`. After a second or so the LEDs should clear.\n\nI had to find different sources to create this flow, so hopefully, this helps out anyone who wants to set it up the same way. Have fun and if you have it running, please share pictures of your awesome Pi!\n\n**Check the [finished script](https://github.com/khendrikse/blinkt-purple-blue/blob/master/blue_purple_with_cleanup.py)**\n\n_Sources:_\n[Five ways to run a program on your Raspberry Pi at startup](https://www.dexterindustries.com/howto/run-a-program-on-your-raspberry-pi-at-startup/)\n[crontab](http://man7.org/linux/man-pages/man5/crontab.5.html)\n[Signal](https://docs.python.org/3/library/signal.html)\n[Handling Unix Signals in Python](https://stackabuse.com/handling-unix-signals-in-python/)\n[Sys exit](https://docs.python.org/2/library/sys.html)\n","date":["2020-02-02"]},"__N_SSG":true},"page":"/post/[postname]","query":{"postname":"2020-02-02-light-up-leds-when-you-start-your-raspberry-pi-and-clear-them-on-shutdown"},"buildId":"Lx-5Y212UvIhz6ZuVNGXm","runtimeConfig":{},"isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>