<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="Online space, blog and portfolio"/><title>Karin Hendrikse | Light up LEDs when you start your Raspberry Pi and clear them on shutdown</title><script type="application/ld+json">{&quot;@context&quot;:&quot;https://schema.org/&quot;,&quot;@type&quot;:&quot;BreadcrumbList&quot;,&quot;itemListElement&quot;:[{&quot;@type&quot;:&quot;ListItem&quot;,&quot;position&quot;:1,&quot;name&quot;:&quot;home&quot;,&quot;item&quot;:&quot;https://khendrikse.github.io/&quot;},{&quot;@type&quot;:&quot;ListItem&quot;,&quot;position&quot;:2,&quot;name&quot;:&quot;blog&quot;,&quot;item&quot;:&quot;https://khendrikse.github.io/blog/&quot;},{&quot;@type&quot;:&quot;ListItem&quot;,&quot;position&quot;:3,&quot;name&quot;:&quot;Light up LEDs when you start your Raspberry Pi and clear them on shutdown&quot;,&quot;item&quot;:&quot;https://khendrikse.github.io/post/2020-02-02-light-up-leds-when-you-start-your-raspberry-pi-and-clear-them-on-shutdown&quot;}]}</script><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/712c88f00d05ee40.css" as="style"/><link rel="stylesheet" href="/_next/static/css/712c88f00d05ee40.css" data-n-g=""/><link rel="preload" href="/_next/static/css/03191e7d313ab930.css" as="style"/><link rel="stylesheet" href="/_next/static/css/03191e7d313ab930.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-6f22bfb6ab07d707.js" defer=""></script><script src="/_next/static/chunks/framework-5d917c6d60c28f7c.js" defer=""></script><script src="/_next/static/chunks/main-c5f572bf693152d0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ff8e7e8c05220191.js" defer=""></script><script src="/_next/static/chunks/103-fac3e5a613e6c36e.js" defer=""></script><script src="/_next/static/chunks/682-ba7ed80520a90eba.js" defer=""></script><script src="/_next/static/chunks/600-b88dde15b40655ac.js" defer=""></script><script src="/_next/static/chunks/175-9a4c26ac43d5d542.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bpostname%5D-9d3bdbb99b6f8bae.js" defer=""></script><script src="/_next/static/4OWx1Aktir_tYSFI5ybN_/_buildManifest.js" defer=""></script><script src="/_next/static/4OWx1Aktir_tYSFI5ybN_/_ssgManifest.js" defer=""></script><script src="/_next/static/4OWx1Aktir_tYSFI5ybN_/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="wrapper"><section class="layout"><header><nav class="navbar_navbar__lC1dX"><div class="navbar_navbar__inner__u9kLF"><h1 class="navbar_navbar__title__oKE_L"><a href="/">Karin Hendrikse</a></h1><ul class="navbar_navbar__menu__XlTKp"><li><a class="navbar_navbar__menu__item__6e5_F" href="/about">About</a></li><li><a class="navbar_navbar__menu__item__6e5_F" href="/blog">Blog</a></li><li><a class="navbar_navbar__menu__item__6e5_F" href="/projects">Projects</a></li><li><a class="navbar_navbar__menu__item__6e5_F" href="/">Home</a></li><li><a class="navbar_navbar__menu__icon__cKwHu" aria-label="RSS feed" href="https://khendrikse.github.io/feeds/feed.xml"><svg width="14px" height="14px" alt="RSS" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.503 20.752A3.25 3.25 0 0 1 3.252 24 3.25 3.25 0 0 1 0 20.752a3.25 3.25 0 0 1 3.252-3.248 3.25 3.25 0 0 1 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242 0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24C23.97 10.769 13.245.046 0 0v4.812z"></path></svg></a></li></ul></div></nav></header><div class="content"><article><img class="post_post__header__image__F9dvV" src="https://dev-to-uploads.s3.amazonaws.com/i/5o1drx3yby1z853rjm8d.JPG?lqip" alt="a raspberry pi with blue and purple LEDs lighting up" style="transition:0.2s filter linear;filter:blur(20px)"/><div class="container"><div class="post_post__header__title__nmuW6"><div class="breadcrumbs_breadcrumbs__K4VlV"><span><a href="/">Home</a></span><span><a href="/blog">blog</a></span><span>Light up LEDs when you start your Raspberry Pi and clear them on shutdown</span></div><h2>Light up LEDs when you start your Raspberry Pi and clear them on shutdown</h2><div class="post_post__date_label__jb050">2020-02-02</div></div></div><div class="post_post__body__Iz5iR"><div class="container"><div class="post_post__intro__JzsWI">In the last post we set up a small script to light up the Blinkt with beautiful purple-blue lights. In this post we&#x27;re going to automatically run a script when we turn the Pi on and stop and clear the LEDs when we turn it off.</div><p><em>You can actually use the techniques in this tutorial for any other script or board.</em></p>
<h2>Start the script when the Pi turns on</h2>
<p>There are many different ways to start running a script when the Pi is booting up. We are going to use <code>crontab</code>.</p>
<p>With <code>crontab</code> we can automate running a script at a certain moment. There are different options, such as running a script <code>yearly</code>, <code>daily</code> or on <code>reboot</code>. We will be using that last option ðŸ˜‰.</p>
<p>Make sure to be logged into your Pi and in the terminal run:</p>
<pre><pre style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-bash" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token token" style="color:#c792ea">crontab</span><span> -e</span></code></pre></pre>
<p>This will open <code>crontab</code> in your editor. At the bottom of the file add:</p>
<pre><pre style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-bash" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>@reboot python /home/pi/Pimoroni/blue_purple.py </span><span class="token token" style="color:#89ddff">&amp;</span></code></pre></pre>
<p>We use <code>@reboot</code> to tell the <code>crontab</code> that we want to run the script whenever the device reboots. <code>python</code> is used to run the Python script and <code>&amp;</code> makes the script run as a background script so you can use your terminal while the script is running. Make sure to add the absolute path to the script you want to run when starting up.</p>
<p>Save and close the file, that&#x27;s it for the first part. You can now restart your Pi with <code>sudo reboot</code> and it should automatically start running your script in the background once it starts up again.</p>
<h3>How to kill your background process</h3>
<p>If for any reason you want to stop the script, all you have to do is find its Process Identifier (PID) by running <code>ps aux | grep python</code> and finding the script in the list of processes. The output would look something like this:</p>
<pre><pre style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-bash" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>pi         </span><span class="token token" style="color:#fd9170">394</span><span> </span><span class="token token" style="color:#fd9170">35.3</span><span>  </span><span class="token token" style="color:#fd9170">1.7</span><span>  </span><span class="token token" style="color:#fd9170">32420</span><span> </span><span class="token token" style="color:#fd9170">16352</span><span> ?        S    </span><span class="token token" style="color:#fd9170">12</span><span>:09  </span><span class="token token" style="color:#fd9170">34</span><span>:34 python /home/pi/Pimoroni/blue_purple.py
</span><span>pi         </span><span class="token token" style="color:#fd9170">771</span><span>  </span><span class="token token" style="color:#fd9170">0.0</span><span>  </span><span class="token token" style="color:#fd9170">0.0</span><span>   </span><span class="token token" style="color:#fd9170">7348</span><span>   </span><span class="token token" style="color:#fd9170">492</span><span> pts/0    S+   </span><span class="token token" style="color:#fd9170">13</span><span>:46   </span><span class="token token" style="color:#fd9170">0</span><span>:00 </span><span class="token token" style="color:#c792ea">grep</span><span> --color</span><span class="token token" style="color:#89ddff">=</span><span>auto python
</span>
</code></pre></pre>
<p>The PID is the number right next to the <code>pi</code>. In the example, it is <code>394</code> Once you have the PID run <code>kill 349</code> replacing <code>349</code> with the number of your PID.</p>
<h3>Turning off the LEDs and clearing them</h3>
<p>Let&#x27;s run a little test. Try shutting down your Pi while the LEDs are running. We can do that by typing:</p>
<pre><pre style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-bash" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token token" style="color:#c792ea">sudo</span><span> </span><span class="token token" style="color:#c792ea">shutdown</span><span> now</span></code></pre></pre>
<p>The Pi will shut itself down and the background script will also stop running. But you might notice that the LEDs did not clear. The Blinkt library has a function for clearing the LEDs when the script stops: <code>blinkt.set_clear_on_exit()</code>. But that only works when the script is explicitly stopped by us. On shutdown, this will have no effect. And as the Blinkt pixels seem to have memory, they will not clear unless we tell them to, or turn off the power.</p>
<p>So, let&#x27;s fix this.</p>
<p>Inside our Python script we are going to add a new library called <code>signal</code> underneath our other libraries:</p>
<pre><pre style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-py" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#546e7a">#!/usr/bin/env python</span><span>
</span>
<span></span><span class="token token" style="color:#c792ea;font-style:italic">import</span><span> blinkt
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">import</span><span> time
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">import</span><span> numpy
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">import</span><span> signal </span><span class="token token" style="color:#546e7a"># new one!</span><span>
</span>
</code></pre></pre>
<p>This will import the <code>signal</code> library. This library listens for signals from the system and makes it possible to run a function when we receive a specific signal.</p>
<p>When our Pi shuts down, it will send a signal called <code>SIGTERM</code>. This signal is sent whenever the system is doing a soft shutdown.</p>
<p>If our script receives this signal, we want to clear the LEDs and exit from the Python script. So in our Python file, add:</p>
<pre><pre style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-py" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#c792ea;font-style:italic">def</span><span> </span><span class="token token" style="color:#c792ea">clear_leds</span><span class="token token" style="color:#89ddff">(</span><span>signum</span><span class="token token" style="color:#89ddff">,</span><span> frame</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">:</span><span>
</span><span>        blinkt</span><span class="token token" style="color:#89ddff">.</span><span>clear</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>        blinkt</span><span class="token token" style="color:#89ddff">.</span><span>show</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>        exit</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">)</span><span>
</span>
<span>signal</span><span class="token token" style="color:#89ddff">.</span><span>signal</span><span class="token token" style="color:#89ddff">(</span><span>signal</span><span class="token token" style="color:#89ddff">.</span><span>SIGTERM</span><span class="token token" style="color:#89ddff">,</span><span> clear_leds</span><span class="token token" style="color:#89ddff">)</span></code></pre></pre>
<p>The <code>clear_led</code> function has two arguments it automatically receives from the <code>signal.signal()</code> function. We don&#x27;t really need to use that so we just keep them there. The <code>blinkt.clear()</code> clears the LEDs and the <code>blinkt.show()</code> sets the new changes to the Blinkt so they can be seen. We then exit the Python script with <code>exit(0)</code>.</p>
<p>By writing <code>signal.signal(signal.SIGTERM, clear_leds)</code> the script will listen for the <code>SIGTERM</code> signal. Once it receives it, it will run the <code>clear_leds</code> function.</p>
<p>And that&#x27;s it! Reboot your system and once your LEDs are running again, try shutting the Pi off by using <code>sudo shutdown now</code>. After a second or so the LEDs should clear.</p>
<p>I had to find different sources to create this flow, so hopefully, this helps out anyone who wants to set it up the same way. Have fun and if you have it running, please share pictures of your awesome Pi!</p>
<p><strong>Check the <a href="https://github.com/khendrikse/blinkt-purple-blue/blob/master/blue_purple_with_cleanup.py">finished script</a></strong></p>
<p><em>Sources:</em>
<a href="https://www.dexterindustries.com/howto/run-a-program-on-your-raspberry-pi-at-startup/">Five ways to run a program on your Raspberry Pi at startup</a>
<a href="http://man7.org/linux/man-pages/man5/crontab.5.html">crontab</a>
<a href="https://docs.python.org/3/library/signal.html">Signal</a>
<a href="https://stackabuse.com/handling-unix-signals-in-python/">Handling Unix Signals in Python</a>
<a href="https://docs.python.org/2/library/sys.html">Sys exit</a></p></div></div></article></div></section></div><div class="footer_footer__7PBRV"><div class="footer_footer__links__Z7tzO"><a class="footer_footer__link__VHWPt" aria-label="DEV.to" href="https://dev.to/khenhey"><svg width="24px" height="24px" alt="DEV.to" viewBox="0 32 448 448" xmlns="http://www.w3.org/2000/svg"><path d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35s5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58z"></path></svg></a><a class="footer_footer__link__VHWPt" aria-label="GitHub" href="https://github.com/khendrikse"><svg width="24px" height="24px" alt="GitHub" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid"><path d="M64 1.564c11.611 0 22.32 2.86 32.125 8.583 9.806 5.722 17.57 13.486 23.292 23.292C125.139 43.244 128 53.953 128 65.564c0 13.944-4.07 26.486-12.208 37.625-8.14 11.139-18.653 18.847-31.542 23.125-1.5.278-2.611.083-3.333-.583a3.237 3.237 0 0 1-1.077-2.273l-.006-.374.064-10.196.017-5.517.002-1.724c0-5.389-1.445-9.333-4.334-11.833 3.167-.334 6.014-.834 8.542-1.5 2.528-.667 5.139-1.75 7.833-3.25 2.695-1.5 4.945-3.348 6.75-5.542 1.806-2.194 3.278-5.111 4.417-8.75 1.139-3.639 1.708-7.82 1.708-12.542 0-6.61-2.194-12.333-6.583-17.166 2.055-5.056 1.833-10.723-.667-17-1.555-.5-3.805-.195-6.75.916-2.944 1.112-5.5 2.334-7.666 3.667l-3.167 2c-5.167-1.444-10.5-2.167-16-2.167s-10.833.723-16 2.167a40.185 40.185 0 0 0-.514-.347l-.571-.375-.308-.197-.658-.416-1.096-.676-.395-.239c-.22-.133-.46-.27-.72-.412l-.543-.289-.594-.299a41.772 41.772 0 0 0-.645-.31l-.696-.32c-.12-.055-.242-.11-.367-.165l-.772-.337-.823-.348-.873-.359-.925-.37c-3.167-1.25-5.528-1.624-7.083-1.124-2.5 6.277-2.722 11.944-.667 17-4.389 4.833-6.583 10.555-6.583 17.166 0 4.723.57 8.89 1.708 12.5 1.139 3.611 2.597 6.528 4.375 8.75 1.778 2.223 4.014 4.084 6.708 5.584 2.695 1.5 5.306 2.583 7.834 3.25 2.527.666 5.375 1.166 8.541 1.5-2.166 2-3.528 4.86-4.083 8.583a16.527 16.527 0 0 1-3.75 1.25c-1.333.278-2.917.417-4.75.417-1.833 0-3.653-.597-5.458-1.792-1.806-1.194-3.348-2.93-4.625-5.208-1.056-1.778-2.403-3.222-4.042-4.334-1.639-1.11-3.014-1.777-4.125-2l-1.667-.25c-1.166 0-1.972.126-2.416.375-.445.25-.584.57-.417.959.167.389.417.778.75 1.166.333.39.695.723 1.083 1l.584.417c1.222.556 2.43 1.611 3.625 3.167 1.194 1.555 2.07 2.972 2.625 4.25l.833 1.916c.722 2.111 1.945 3.82 3.667 5.125 1.722 1.306 3.583 2.14 5.583 2.5 2 .362 3.93.556 5.792.584 1.706.025 3.143-.054 4.313-.239l2.228-.386.01 3.427.074 8.49c0 1-.361 1.833-1.084 2.5-.722.666-1.833.86-3.333.583-12.889-4.278-23.403-11.986-31.542-23.125C4.07 92.049 0 79.509 0 65.564c0-11.612 2.861-22.32 8.583-32.125 5.723-9.806 13.486-17.57 23.292-23.292 9.592-5.598 20.049-8.458 31.37-8.58L64 1.565ZM24.25 93.48c.166-.39-.028-.723-.584-1-.555-.167-.916-.111-1.083.166-.167.39.028.723.583 1 .5.334.862.278 1.084-.166Zm2.583 2.833c.389-.278.333-.722-.167-1.333-.555-.5-1-.584-1.333-.25-.389.277-.333.722.167 1.333.555.555 1 .639 1.333.25Zm2.5 3.75c.5-.389.5-.917 0-1.583-.444-.723-.916-.89-1.416-.5-.5.277-.5.777 0 1.5.5.722.972.916 1.416.583Zm3.5 3.5c.417-.417.345-.907-.215-1.47l-.118-.113c-.667-.667-1.222-.75-1.667-.25-.5.444-.389.972.333 1.583.667.667 1.223.75 1.667.25Zm4.75 2.083c.167-.61-.194-1.055-1.083-1.333-.834-.222-1.361-.028-1.584.583-.222.611.14 1.028 1.084 1.25.781.313 1.294.186 1.538-.38l.045-.12Zm5.25.417c0-.722-.472-1.028-1.417-.917-.888 0-1.333.306-1.333.917 0 .722.472 1.028 1.417.917.83 0 1.272-.267 1.327-.799l.006-.118Zm4.833-.833c-.11-.612-.61-.862-1.5-.75-.888.166-1.277.583-1.166 1.25.11.666.61.888 1.5.666.83-.207 1.224-.56 1.182-1.058l-.016-.108Z" fill="currentColor"></path></svg></a><a class="footer_footer__link__VHWPt" aria-label="linkedin" href="https://www.linkedin.com/in/karinhendrikse/"><svg width="24px" height="24px" alt="LinkedIn" xmlns="http://www.w3.org/2000/svg"><path d="M19 0H5a5 5 0 0 0-5 5v14a5 5 0 0 0 5 5h14a5 5 0 0 0 5-5V5a5 5 0 0 0-5-5zM8 19H5V8h3v11zM6.5 6.732c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zM20 19h-3v-5.604c0-3.368-4-3.113-4 0V19h-3V8h3v1.765c1.396-2.586 7-2.777 7 2.476V19z"></path></svg></a><a class="footer_footer__link__VHWPt" aria-label="RSS feed" href="https://khendrikse.github.io/feeds/feed.xml"><svg width="24px" height="24px" alt="RSS" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.503 20.752A3.25 3.25 0 0 1 3.252 24 3.25 3.25 0 0 1 0 20.752a3.25 3.25 0 0 1 3.252-3.248 3.25 3.25 0 0 1 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242 0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24C23.97 10.769 13.245.046 0 0v4.812z"></path></svg></a>Â© <!-- -->2022<!-- --> Karin Hendrikse</div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"siteTitle":"Karin Hendrikse","frontmatter":{"layout":"post","title":"Light up LEDs when you start your Raspberry Pi and clear them on shutdown","published":true,"description":"Set up your Pimoroni Blinkt so it automatically turns on and off when you start-up or shut down your Raspberry Pi.","cover_image":"https://dev-to-uploads.s3.amazonaws.com/i/5o1drx3yby1z853rjm8d.JPG","cover_image_alt":"a raspberry pi with blue and purple LEDs lighting up","tags":null,"intro":"In the last post we set up a small script to light up the Blinkt with beautiful purple-blue lights. In this post we're going to automatically run a script when we turn the Pi on and stop and clear the LEDs when we turn it off."},"markdownBody":"\n_You can actually use the techniques in this tutorial for any other script or board._\n\n## Start the script when the Pi turns on\n\nThere are many different ways to start running a script when the Pi is booting up. We are going to use `crontab`.\n\nWith `crontab` we can automate running a script at a certain moment. There are different options, such as running a script `yearly`, `daily` or on `reboot`. We will be using that last option ðŸ˜‰.\n\nMake sure to be logged into your Pi and in the terminal run:\n\n```bash\n$ crontab -e\n```\n\nThis will open `crontab` in your editor. At the bottom of the file add:\n\n```bash\n@reboot python /home/pi/Pimoroni/blue_purple.py \u0026\n```\n\nWe use `@reboot` to tell the `crontab` that we want to run the script whenever the device reboots. `python` is used to run the Python script and `\u0026` makes the script run as a background script so you can use your terminal while the script is running. Make sure to add the absolute path to the script you want to run when starting up.\n\nSave and close the file, that's it for the first part. You can now restart your Pi with `sudo reboot` and it should automatically start running your script in the background once it starts up again.\n\n### How to kill your background process\n\nIf for any reason you want to stop the script, all you have to do is find its Process Identifier (PID) by running `ps aux | grep python` and finding the script in the list of processes. The output would look something like this:\n\n```bash\npi         394 35.3  1.7  32420 16352 ?        S    12:09  34:34 python /home/pi/Pimoroni/blue_purple.py\npi         771  0.0  0.0   7348   492 pts/0    S+   13:46   0:00 grep --color=auto python\n\n```\n\nThe PID is the number right next to the `pi`. In the example, it is `394` Once you have the PID run `kill 349` replacing `349` with the number of your PID.\n\n### Turning off the LEDs and clearing them\n\nLet's run a little test. Try shutting down your Pi while the LEDs are running. We can do that by typing:\n\n```bash\n$ sudo shutdown now\n```\n\nThe Pi will shut itself down and the background script will also stop running. But you might notice that the LEDs did not clear. The Blinkt library has a function for clearing the LEDs when the script stops: `blinkt.set_clear_on_exit()`. But that only works when the script is explicitly stopped by us. On shutdown, this will have no effect. And as the Blinkt pixels seem to have memory, they will not clear unless we tell them to, or turn off the power.\n\nSo, let's fix this.\n\nInside our Python script we are going to add a new library called `signal` underneath our other libraries:\n\n```py\n#!/usr/bin/env python\n\nimport blinkt\nimport time\nimport numpy\nimport signal # new one!\n\n```\n\nThis will import the `signal` library. This library listens for signals from the system and makes it possible to run a function when we receive a specific signal.\n\nWhen our Pi shuts down, it will send a signal called `SIGTERM`. This signal is sent whenever the system is doing a soft shutdown.\n\nIf our script receives this signal, we want to clear the LEDs and exit from the Python script. So in our Python file, add:\n\n```py\ndef clear_leds(signum, frame):\n        blinkt.clear()\n        blinkt.show()\n        exit(0)\n\nsignal.signal(signal.SIGTERM, clear_leds)\n```\n\nThe `clear_led` function has two arguments it automatically receives from the `signal.signal()` function. We don't really need to use that so we just keep them there. The `blinkt.clear()` clears the LEDs and the `blinkt.show()` sets the new changes to the Blinkt so they can be seen. We then exit the Python script with `exit(0)`.\n\nBy writing `signal.signal(signal.SIGTERM, clear_leds)` the script will listen for the `SIGTERM` signal. Once it receives it, it will run the `clear_leds` function.\n\nAnd that's it! Reboot your system and once your LEDs are running again, try shutting the Pi off by using `sudo shutdown now`. After a second or so the LEDs should clear.\n\nI had to find different sources to create this flow, so hopefully, this helps out anyone who wants to set it up the same way. Have fun and if you have it running, please share pictures of your awesome Pi!\n\n**Check the [finished script](https://github.com/khendrikse/blinkt-purple-blue/blob/master/blue_purple_with_cleanup.py)**\n\n_Sources:_\n[Five ways to run a program on your Raspberry Pi at startup](https://www.dexterindustries.com/howto/run-a-program-on-your-raspberry-pi-at-startup/)\n[crontab](http://man7.org/linux/man-pages/man5/crontab.5.html)\n[Signal](https://docs.python.org/3/library/signal.html)\n[Handling Unix Signals in Python](https://stackabuse.com/handling-unix-signals-in-python/)\n[Sys exit](https://docs.python.org/2/library/sys.html)\n","date":["2020-02-02"],"slug":"2020-02-02-light-up-leds-when-you-start-your-raspberry-pi-and-clear-them-on-shutdown"},"__N_SSG":true},"page":"/post/[postname]","query":{"postname":"2020-02-02-light-up-leds-when-you-start-your-raspberry-pi-and-clear-them-on-shutdown"},"buildId":"4OWx1Aktir_tYSFI5ybN_","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>