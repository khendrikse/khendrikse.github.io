<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><script type="application/ld+json">{&quot;@context&quot;:&quot;https://schema.org&quot;,&quot;@type&quot;:&quot;BlogPosting&quot;,&quot;mainEntityOfPage&quot;:{&quot;@type&quot;:&quot;WebPage&quot;,&quot;@id&quot;:&quot;https://khendrikse.github.io/light-up-leds-when-you-start-your-raspberry-pi-and-clear-them-on-shutdown&quot;},&quot;headline&quot;:&quot;Light up LEDs when you start your Raspberry Pi and clear them on shutdown&quot;,&quot;description&quot;:&quot;Set up your Pimoroni Blinkt so it automatically turns on and off when you start-up or shut down your Raspberry Pi.&quot;,&quot;image&quot;:&quot;https://dev-to-uploads.s3.amazonaws.com/i/5o1drx3yby1z853rjm8d.JPG&quot;,&quot;datePublished&quot;:[&quot;2020-02-02&quot;],&quot;dateModified&quot;:[&quot;2020-02-02&quot;],&quot;author&quot;:{&quot;@type&quot;:&quot;Person&quot;,&quot;name&quot;:&quot;Karin Hendrikse&quot;,&quot;url&quot;:&quot;https://khendrikse.github.io/about&quot;}}</script><meta http-equiv="refresh" content="2;url=https://khendrikse.github.io/blog/light-up-leds-when-you-start-your-raspberry-pi-and-clear-them-on-shutdown"/><link rel="canonical" href="https://khendrikse.github.io/blog/light-up-leds-when-you-start-your-raspberry-pi-and-clear-them-on-shutdown"/><script type="application/ld+json">{&quot;@context&quot;:&quot;https://schema.org/&quot;,&quot;@type&quot;:&quot;BreadcrumbList&quot;,&quot;itemListElement&quot;:[{&quot;@type&quot;:&quot;ListItem&quot;,&quot;position&quot;:1,&quot;name&quot;:&quot;home&quot;,&quot;item&quot;:&quot;https://khendrikse.github.io/&quot;},{&quot;@type&quot;:&quot;ListItem&quot;,&quot;position&quot;:2,&quot;name&quot;:&quot;blog&quot;,&quot;item&quot;:&quot;https://khendrikse.github.io/blog/&quot;},{&quot;@type&quot;:&quot;ListItem&quot;,&quot;position&quot;:3,&quot;name&quot;:&quot;Light up LEDs when you start your Raspberry Pi and clear them on shutdown&quot;,&quot;item&quot;:&quot;https://khendrikse.github.io/post/light-up-leds-when-you-start-your-raspberry-pi-and-clear-them-on-shutdown&quot;}]}</script><title>Light up LEDs when you start your Raspberry Pi and clear...</title><meta name="twitter:title" content="Light up LEDs when you start your Raspberry Pi and clear them on..."/><meta property="og:title" content="Light up LEDs when you start your Raspberry Pi and clear them on shutdown | Karin..."/><meta name="description" content="Set up your Pimoroni Blinkt so it automatically turns on and off when you start-up or shut down your Raspberry Pi."/><meta name="twitter:description" content="Set up your Pimoroni Blinkt so it automatically turns on and off when you start-up or shut down your Raspberry Pi."/><meta property="og:description" content="Set up your Pimoroni Blinkt so it automatically turns on and off when you start-up or shut down your Raspberry Pi."/><meta name="twitter:site" content="@k_henhey"/><meta name="twitter:creator" content="@k_henhey"/><meta name="twitter:card" content="summary"/><meta property="og:type" content="article"/><meta property="og:url" content="https://khendrikse.github.io/post/light-up-leds-when-you-start-your-raspberry-pi-and-clear-them-on-shutdown"/><meta name="twitter:image" content="https://dev-to-uploads.s3.amazonaws.com/i/5o1drx3yby1z853rjm8d.JPG"/><meta property="og:image" content="https://dev-to-uploads.s3.amazonaws.com/i/5o1drx3yby1z853rjm8d.JPG"/><meta name="twitter:image:alt" content="a raspberry pi with blue and purple LEDs lighting up"/><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/95df6376c575c08c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/95df6376c575c08c.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cd72f785afe8166e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cd72f785afe8166e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-96c04c6e24cd191a.js" defer=""></script><script src="/_next/static/chunks/framework-470a35b62546b22b.js" defer=""></script><script src="/_next/static/chunks/main-740f5a85dd3b65b2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0118443234c788d7.js" defer=""></script><script src="/_next/static/chunks/d0447323-f8acf20273622023.js" defer=""></script><script src="/_next/static/chunks/0c428ae2-59051706ed2820c0.js" defer=""></script><script src="/_next/static/chunks/743-9c1655925b27cc5f.js" defer=""></script><script src="/_next/static/chunks/603-1468965eb9ac938a.js" defer=""></script><script src="/_next/static/chunks/580-667f6f51087272d3.js" defer=""></script><script src="/_next/static/chunks/723-061ff00fc4948a2e.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bpostname%5D-12b5803e54105d8c.js" defer=""></script><script src="/_next/static/K74JPLidri1Xpu-CLYQ4D/_buildManifest.js" defer=""></script><script src="/_next/static/K74JPLidri1Xpu-CLYQ4D/_ssgManifest.js" defer=""></script><script src="/_next/static/K74JPLidri1Xpu-CLYQ4D/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="wrapper"><section class="layout"><header><nav class="navbar_navbar__lC1dX"><div class="navbar_navbar__inner__u9kLF"><h1 class="navbar_navbar__title__oKE_L"><a href="/">Karin Hendrikse</a></h1><ul class="navbar_navbar__menu__XlTKp"><li><a class="navbar_navbar__menu__item__6e5_F" href="/about">About</a></li><li><a class="navbar_navbar__menu__item__6e5_F" href="/blog">Blog</a></li><li><a class="navbar_navbar__menu__item__6e5_F" href="/projects">Projects</a></li><li><a class="navbar_navbar__menu__item__6e5_F" href="/">Home</a></li><li><a class="navbar_navbar__menu__icon__cKwHu" aria-label="RSS feed" href="https://khendrikse.github.io/feeds/feed.xml"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" alt="RSS" height="14px" width="14px" xmlns="http://www.w3.org/2000/svg"><path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm1.5 2.5c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1 0-2zm0 4a6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1 0-2zm.5 7a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"></path></svg></a></li></ul></div></nav></header><div class="content"><article><img class="post_post__header__image__F9dvV" src="https://dev-to-uploads.s3.amazonaws.com/i/5o1drx3yby1z853rjm8d.JPG?lqip" alt="a raspberry pi with blue and purple LEDs lighting up" style="transition:0.2s filter linear;filter:blur(20px)"/><div class="container"><div class="post_post__header__title__nmuW6"><h2>Light up LEDs when you start your Raspberry Pi and clear them on shutdown</h2><div class="post_post__date_label__jb050">2020-02-02</div></div></div><div class="post_post__body__Iz5iR"><div class="container"><div class="post_post__intro__JzsWI">In the last post we set up a small script to light up the Blinkt with beautiful purple-blue lights. In this post we&#x27;re going to automatically run a script when we turn the Pi on and stop and clear the LEDs when we turn it off.</div><p><em>You can actually use the techniques in this tutorial for any other script or board.</em></p>
<h2>Start the script when the Pi turns on</h2>
<p>There are many different ways to start running a script when the Pi is booting up. We are going to use <code>crontab</code>.</p>
<p>With <code>crontab</code> we can automate running a script at a certain moment. There are different options, such as running a script <code>yearly</code>, <code>daily</code> or on <code>reboot</code>. We will be using that last option ðŸ˜‰.</p>
<p>Make sure to be logged into your Pi and in the terminal run:</p>
<pre><pre style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-bash" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token token" style="color:#c792ea">crontab</span><span> -e</span></code></pre></pre>
<p>This will open <code>crontab</code> in your editor. At the bottom of the file add:</p>
<pre><pre style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-bash" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>@reboot python /home/pi/Pimoroni/blue_purple.py </span><span class="token token" style="color:#89ddff">&amp;</span></code></pre></pre>
<p>We use <code>@reboot</code> to tell the <code>crontab</code> that we want to run the script whenever the device reboots. <code>python</code> is used to run the Python script and <code>&amp;</code> makes the script run as a background script so you can use your terminal while the script is running. Make sure to add the absolute path to the script you want to run when starting up.</p>
<p>Save and close the file, that&#x27;s it for the first part. You can now restart your Pi with <code>sudo reboot</code> and it should automatically start running your script in the background once it starts up again.</p>
<h3>How to kill your background process</h3>
<p>If for any reason you want to stop the script, all you have to do is find its Process Identifier (PID) by running <code>ps aux | grep python</code> and finding the script in the list of processes. The output would look something like this:</p>
<pre><pre style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-bash" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>pi         </span><span class="token token" style="color:#fd9170">394</span><span> </span><span class="token token" style="color:#fd9170">35.3</span><span>  </span><span class="token token" style="color:#fd9170">1.7</span><span>  </span><span class="token token" style="color:#fd9170">32420</span><span> </span><span class="token token" style="color:#fd9170">16352</span><span> ?        S    </span><span class="token token" style="color:#fd9170">12</span><span>:09  </span><span class="token token" style="color:#fd9170">34</span><span>:34 python /home/pi/Pimoroni/blue_purple.py
</span><span>pi         </span><span class="token token" style="color:#fd9170">771</span><span>  </span><span class="token token" style="color:#fd9170">0.0</span><span>  </span><span class="token token" style="color:#fd9170">0.0</span><span>   </span><span class="token token" style="color:#fd9170">7348</span><span>   </span><span class="token token" style="color:#fd9170">492</span><span> pts/0    S+   </span><span class="token token" style="color:#fd9170">13</span><span>:46   </span><span class="token token" style="color:#fd9170">0</span><span>:00 </span><span class="token token" style="color:#c792ea">grep</span><span> --color</span><span class="token token" style="color:#89ddff">=</span><span>auto python
</span>
</code></pre></pre>
<p>The PID is the number right next to the <code>pi</code>. In the example, it is <code>394</code> Once you have the PID run <code>kill 349</code> replacing <code>349</code> with the number of your PID.</p>
<h3>Turning off the LEDs and clearing them</h3>
<p>Let&#x27;s run a little test. Try shutting down your Pi while the LEDs are running. We can do that by typing:</p>
<pre><pre style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-bash" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token token" style="color:#c792ea">sudo</span><span> </span><span class="token token" style="color:#c792ea">shutdown</span><span> now</span></code></pre></pre>
<p>The Pi will shut itself down and the background script will also stop running. But you might notice that the LEDs did not clear. The Blinkt library has a function for clearing the LEDs when the script stops: <code>blinkt.set_clear_on_exit()</code>. But that only works when the script is explicitly stopped by us. On shutdown, this will have no effect. And as the Blinkt pixels seem to have memory, they will not clear unless we tell them to, or turn off the power.</p>
<p>So, let&#x27;s fix this.</p>
<p>Inside our Python script we are going to add a new library called <code>signal</code> underneath our other libraries:</p>
<pre><pre style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-py" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#546e7a">#!/usr/bin/env python</span><span>
</span>
<span></span><span class="token token" style="color:#c792ea;font-style:italic">import</span><span> blinkt
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">import</span><span> time
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">import</span><span> numpy
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">import</span><span> signal </span><span class="token token" style="color:#546e7a"># new one!</span><span>
</span>
</code></pre></pre>
<p>This will import the <code>signal</code> library. This library listens for signals from the system and makes it possible to run a function when we receive a specific signal.</p>
<p>When our Pi shuts down, it will send a signal called <code>SIGTERM</code>. This signal is sent whenever the system is doing a soft shutdown.</p>
<p>If our script receives this signal, we want to clear the LEDs and exit from the Python script. So in our Python file, add:</p>
<pre><pre style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-py" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#c792ea;font-style:italic">def</span><span> </span><span class="token token" style="color:#c792ea">clear_leds</span><span class="token token" style="color:#89ddff">(</span><span>signum</span><span class="token token" style="color:#89ddff">,</span><span> frame</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">:</span><span>
</span><span>        blinkt</span><span class="token token" style="color:#89ddff">.</span><span>clear</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>        blinkt</span><span class="token token" style="color:#89ddff">.</span><span>show</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>        exit</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">)</span><span>
</span>
<span>signal</span><span class="token token" style="color:#89ddff">.</span><span>signal</span><span class="token token" style="color:#89ddff">(</span><span>signal</span><span class="token token" style="color:#89ddff">.</span><span>SIGTERM</span><span class="token token" style="color:#89ddff">,</span><span> clear_leds</span><span class="token token" style="color:#89ddff">)</span></code></pre></pre>
<p>The <code>clear_led</code> function has two arguments it automatically receives from the <code>signal.signal()</code> function. We don&#x27;t really need to use that so we just keep them there. The <code>blinkt.clear()</code> clears the LEDs and the <code>blinkt.show()</code> sets the new changes to the Blinkt so they can be seen. We then exit the Python script with <code>exit(0)</code>.</p>
<p>By writing <code>signal.signal(signal.SIGTERM, clear_leds)</code> the script will listen for the <code>SIGTERM</code> signal. Once it receives it, it will run the <code>clear_leds</code> function.</p>
<p>And that&#x27;s it! Reboot your system and once your LEDs are running again, try shutting the Pi off by using <code>sudo shutdown now</code>. After a second or so the LEDs should clear.</p>
<p>I had to find different sources to create this flow, so hopefully, this helps out anyone who wants to set it up the same way. Have fun and if you have it running, please share pictures of your awesome Pi!</p>
<p><strong>Check the <a href="https://github.com/khendrikse/blinkt-purple-blue/blob/master/blue_purple_with_cleanup.py">finished script</a></strong></p>
<p><em>Sources:</em>
<a href="https://www.dexterindustries.com/howto/run-a-program-on-your-raspberry-pi-at-startup/">Five ways to run a program on your Raspberry Pi at startup</a>
<a href="http://man7.org/linux/man-pages/man5/crontab.5.html">crontab</a>
<a href="https://docs.python.org/3/library/signal.html">Signal</a>
<a href="https://stackabuse.com/handling-unix-signals-in-python/">Handling Unix Signals in Python</a>
<a href="https://docs.python.org/2/library/sys.html">Sys exit</a></p></div></div></article></div></section></div><div class="footer_footer__7PBRV"><div class="footer_footer__links__Z7tzO"><a class="footer_footer__link__VHWPt" aria-label="GitHub" href="https://github.com/khendrikse"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" alt="GitHub" height="24px" width="24px" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg></a><a class="footer_footer__link__VHWPt" aria-label="linkedin" href="https://www.linkedin.com/in/karinhendrikse/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" alt="LinkedIn" height="24px" width="24px" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a class="footer_footer__link__VHWPt" aria-label="Twitter" href="https://twitter.com/k_henhey"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" alt="Twitter" height="24px" width="24px" xmlns="http://www.w3.org/2000/svg"><path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z"></path></svg></a><a class="footer_footer__link__VHWPt" aria-label="DEV.to" href="https://dev.to/khenhey"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" alt="DEV.to" height="24px" width="24px" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M7.42 10.05c-.18-.16-.46-.23-.84-.23H6l.02 2.44.04 2.45.56-.02c.41 0 .63-.07.83-.26.24-.24.26-.36.26-2.2 0-1.91-.02-1.96-.29-2.18zM0 4.94v14.12h24V4.94H0zM8.56 15.3c-.44.58-1.06.77-2.53.77H4.71V8.53h1.4c1.67 0 2.16.18 2.6.9.27.43.29.6.32 2.57.05 2.23-.02 2.73-.47 3.3zm5.09-5.47h-2.47v1.77h1.52v1.28l-.72.04-.75.03v1.77l1.22.03 1.2.04v1.28h-1.6c-1.53 0-1.6-.01-1.87-.3l-.3-.28v-3.16c0-3.02.01-3.18.25-3.48.23-.31.25-.31 1.88-.31h1.64v1.3zm4.68 5.45c-.17.43-.64.79-1 .79-.18 0-.45-.15-.67-.39-.32-.32-.45-.63-.82-2.08l-.9-3.39-.45-1.67h.76c.4 0 .75.02.75.05 0 .06 1.16 4.54 1.26 4.83.04.15.32-.7.73-2.3l.66-2.52.74-.04c.4-.02.73 0 .73.04 0 .14-1.67 6.38-1.8 6.68z"></path></svg></a><a class="footer_footer__link__VHWPt" aria-label="RSS feed" href="https://khendrikse.github.io/feeds/feed.xml"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" alt="RSS" height="24px" width="24px" xmlns="http://www.w3.org/2000/svg"><path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm1.5 2.5c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1 0-2zm0 4a6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1 0-2zm.5 7a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"></path></svg></a>Â© <!-- -->2022<!-- --> Karin Hendrikse</div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"siteTitle":"Karin Hendrikse","frontmatter":{"layout":"post","title":"Light up LEDs when you start your Raspberry Pi and clear them on shutdown","published":true,"oldBlog":true,"date":"2020-02-02","description":"Set up your Pimoroni Blinkt so it automatically turns on and off when you start-up or shut down your Raspberry Pi.","cover_image":"https://dev-to-uploads.s3.amazonaws.com/i/5o1drx3yby1z853rjm8d.JPG","cover_image_alt":"a raspberry pi with blue and purple LEDs lighting up","tags":null,"intro":"In the last post we set up a small script to light up the Blinkt with beautiful purple-blue lights. In this post we're going to automatically run a script when we turn the Pi on and stop and clear the LEDs when we turn it off."},"markdownBody":"\n_You can actually use the techniques in this tutorial for any other script or board._\n\n## Start the script when the Pi turns on\n\nThere are many different ways to start running a script when the Pi is booting up. We are going to use `crontab`.\n\nWith `crontab` we can automate running a script at a certain moment. There are different options, such as running a script `yearly`, `daily` or on `reboot`. We will be using that last option ðŸ˜‰.\n\nMake sure to be logged into your Pi and in the terminal run:\n\n```bash\n$ crontab -e\n```\n\nThis will open `crontab` in your editor. At the bottom of the file add:\n\n```bash\n@reboot python /home/pi/Pimoroni/blue_purple.py \u0026\n```\n\nWe use `@reboot` to tell the `crontab` that we want to run the script whenever the device reboots. `python` is used to run the Python script and `\u0026` makes the script run as a background script so you can use your terminal while the script is running. Make sure to add the absolute path to the script you want to run when starting up.\n\nSave and close the file, that's it for the first part. You can now restart your Pi with `sudo reboot` and it should automatically start running your script in the background once it starts up again.\n\n### How to kill your background process\n\nIf for any reason you want to stop the script, all you have to do is find its Process Identifier (PID) by running `ps aux | grep python` and finding the script in the list of processes. The output would look something like this:\n\n```bash\npi         394 35.3  1.7  32420 16352 ?        S    12:09  34:34 python /home/pi/Pimoroni/blue_purple.py\npi         771  0.0  0.0   7348   492 pts/0    S+   13:46   0:00 grep --color=auto python\n\n```\n\nThe PID is the number right next to the `pi`. In the example, it is `394` Once you have the PID run `kill 349` replacing `349` with the number of your PID.\n\n### Turning off the LEDs and clearing them\n\nLet's run a little test. Try shutting down your Pi while the LEDs are running. We can do that by typing:\n\n```bash\n$ sudo shutdown now\n```\n\nThe Pi will shut itself down and the background script will also stop running. But you might notice that the LEDs did not clear. The Blinkt library has a function for clearing the LEDs when the script stops: `blinkt.set_clear_on_exit()`. But that only works when the script is explicitly stopped by us. On shutdown, this will have no effect. And as the Blinkt pixels seem to have memory, they will not clear unless we tell them to, or turn off the power.\n\nSo, let's fix this.\n\nInside our Python script we are going to add a new library called `signal` underneath our other libraries:\n\n```py\n#!/usr/bin/env python\n\nimport blinkt\nimport time\nimport numpy\nimport signal # new one!\n\n```\n\nThis will import the `signal` library. This library listens for signals from the system and makes it possible to run a function when we receive a specific signal.\n\nWhen our Pi shuts down, it will send a signal called `SIGTERM`. This signal is sent whenever the system is doing a soft shutdown.\n\nIf our script receives this signal, we want to clear the LEDs and exit from the Python script. So in our Python file, add:\n\n```py\ndef clear_leds(signum, frame):\n        blinkt.clear()\n        blinkt.show()\n        exit(0)\n\nsignal.signal(signal.SIGTERM, clear_leds)\n```\n\nThe `clear_led` function has two arguments it automatically receives from the `signal.signal()` function. We don't really need to use that so we just keep them there. The `blinkt.clear()` clears the LEDs and the `blinkt.show()` sets the new changes to the Blinkt so they can be seen. We then exit the Python script with `exit(0)`.\n\nBy writing `signal.signal(signal.SIGTERM, clear_leds)` the script will listen for the `SIGTERM` signal. Once it receives it, it will run the `clear_leds` function.\n\nAnd that's it! Reboot your system and once your LEDs are running again, try shutting the Pi off by using `sudo shutdown now`. After a second or so the LEDs should clear.\n\nI had to find different sources to create this flow, so hopefully, this helps out anyone who wants to set it up the same way. Have fun and if you have it running, please share pictures of your awesome Pi!\n\n**Check the [finished script](https://github.com/khendrikse/blinkt-purple-blue/blob/master/blue_purple_with_cleanup.py)**\n\n_Sources:_\n[Five ways to run a program on your Raspberry Pi at startup](https://www.dexterindustries.com/howto/run-a-program-on-your-raspberry-pi-at-startup/)\n[crontab](http://man7.org/linux/man-pages/man5/crontab.5.html)\n[Signal](https://docs.python.org/3/library/signal.html)\n[Handling Unix Signals in Python](https://stackabuse.com/handling-unix-signals-in-python/)\n[Sys exit](https://docs.python.org/2/library/sys.html)\n","date":["2020-02-02"],"slug":"light-up-leds-when-you-start-your-raspberry-pi-and-clear-them-on-shutdown","image":"https://dev-to-uploads.s3.amazonaws.com/i/5o1drx3yby1z853rjm8d.JPG"},"__N_SSG":true},"page":"/post/[postname]","query":{"postname":"2020-02-02-light-up-leds-when-you-start-your-raspberry-pi-and-clear-them-on-shutdown"},"buildId":"K74JPLidri1Xpu-CLYQ4D","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>